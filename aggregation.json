{
  "step 1": {
    "filters": {
      "filters": {
        "other_orders": {
          "nested": {
            "path": "employees",
            "query": {
              "bool": {
                "must": [
                  {
                    "nested": {
                      "path": "employees.bookings",
                      "query": {
                        "bool": {
                          "must_not": [
                            {
                              "term": {
                                "employees.bookings.order_id": {
                                  "value": "3l0C3GsBMgHivpysT9hG"
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "current_order": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "term": {
                    "employees.bookings.order_id": {
                      "value": "3l0C3GsBMgHivpysT9hG"
                    }
                  }
                }
              }
            }
          }
        },
        "no_bookings": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "bool": {
                    "must_not": [
                      {
                        "exists": {
                          "field": "employees.bookings.status_id"
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "aggs": {
      "blocked_minutes_filter": {
        "filter": {
          "bool": {
            "must_not": [
              {
                "terms": {
                  "number": [
                    721,
                    722,
                    723,
                    724,
                    725,
                    726,
                    727,
                    728,
                    729,
                    730,
                    101,
                    720,
                    91,
                    92,
                    93,
                    94,
                    95,
                    96,
                    97,
                    98,
                    99,
                    100,
                    160,
                    161,
                    162,
                    163,
                    164,
                    165,
                    166,
                    167,
                    168,
                    169,
                    170,
                    230,
                    231,
                    232,
                    233,
                    234,
                    235,
                    236,
                    237,
                    238,
                    239,
                    240,
                    300,
                    301,
                    302,
                    303,
                    304,
                    305,
                    306,
                    307,
                    308,
                    309,
                    310,
                    370,
                    371,
                    372,
                    373,
                    374,
                    375,
                    376,
                    377,
                    378,
                    379,
                    380,
                    440,
                    441,
                    442,
                    443,
                    444,
                    445,
                    446,
                    447,
                    448,
                    449,
                    450,
                    510,
                    511,
                    512,
                    513,
                    514,
                    515,
                    516,
                    517,
                    518,
                    519,
                    520,
                    580,
                    581,
                    582,
                    583,
                    584,
                    585,
                    586,
                    587,
                    588,
                    589,
                    590,
                    650
                  ]
                }
              }
            ]
          }
        },
        "aggs": {
          "employees": {
            "nested": {
              "path": "employees"
            },
            "aggs": {
              "back_to_minutes": {
                "reverse_nested": {
                },
                "aggs": {
                  "status_minute_range": {
                    "filter": {
                      "range": {
                        "number": {
                          "gte": 100,
                          "lte": 160
                        }
                      }
                    },
                    "aggs": {
                      "employee_again": {
                        "nested": {
                          "path": "employees"
                        },
                        "aggs": {
                          "status_id_filter": {
                            "filter": {
                              "term": {
                                "employees.status_ids": "step 1"
                              }
                            },
                            "aggs": {
                              "minute": {
                                "reverse_nested": {
                                },
                                "aggs": {
                                  "minute_histogram": {
                                    "histogram": {
                                      "field": "number",
                                      "interval": 1
                                    },
                                    "aggs": {
                                      "employee": {
                                        "nested": {
                                          "path": "employees"
                                        },
                                        "aggs": {
                                          "employee": {
                                            "terms": {
                                              "field": "employees.number",
                                              "size": 1
                                            },
                                            "aggs": {
                                              "employee_id": {
                                                "terms": {
                                                  "field": "employees.employee_id",
                                                  "size": 1
                                                },
                                                "aggs": {
                                                  "bookings": {
                                                    "nested": {
                                                      "path": "employees.bookings"
                                                    },
                                                    "aggs": {
                                                      "booking": {
                                                        "terms": {
                                                          "field": "employees.bookings.booking_id",
                                                          "size": 1
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "step 2": {
    "filters": {
      "filters": {
        "other_orders": {
          "nested": {
            "path": "employees",
            "query": {
              "bool": {
                "must": [
                  {
                    "nested": {
                      "path": "employees.bookings",
                      "query": {
                        "bool": {
                          "must_not": [
                            {
                              "term": {
                                "employees.bookings.order_id": {
                                  "value": "3l0C3GsBMgHivpysT9hG"
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "current_order": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "term": {
                    "employees.bookings.order_id": {
                      "value": "3l0C3GsBMgHivpysT9hG"
                    }
                  }
                }
              }
            }
          }
        },
        "no_bookings": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "bool": {
                    "must_not": [
                      {
                        "exists": {
                          "field": "employees.bookings.status_id"
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "aggs": {
      "blocked_minutes_filter": {
        "filter": {
          "bool": {
            "must_not": [
              {
                "terms": {
                  "number": [
                    721,
                    722,
                    723,
                    724,
                    725,
                    726,
                    727,
                    728,
                    729,
                    730,
                    170,
                    720,
                    91,
                    92,
                    93,
                    94,
                    95,
                    96,
                    97,
                    98,
                    99,
                    100,
                    101,
                    160,
                    161,
                    162,
                    163,
                    164,
                    165,
                    166,
                    167,
                    168,
                    169,
                    230,
                    231,
                    232,
                    233,
                    234,
                    235,
                    236,
                    237,
                    238,
                    239,
                    240,
                    300,
                    301,
                    302,
                    303,
                    304,
                    305,
                    306,
                    307,
                    308,
                    309,
                    310,
                    370,
                    371,
                    372,
                    373,
                    374,
                    375,
                    376,
                    377,
                    378,
                    379,
                    380,
                    440,
                    441,
                    442,
                    443,
                    444,
                    445,
                    446,
                    447,
                    448,
                    449,
                    450,
                    510,
                    511,
                    512,
                    513,
                    514,
                    515,
                    516,
                    517,
                    518,
                    519,
                    520,
                    580,
                    581,
                    582,
                    583,
                    584,
                    585,
                    586,
                    587,
                    588,
                    589,
                    590,
                    650
                  ]
                }
              }
            ]
          }
        },
        "aggs": {
          "employees": {
            "nested": {
              "path": "employees"
            },
            "aggs": {
              "back_to_minutes": {
                "reverse_nested": {
                },
                "aggs": {
                  "status_minute_range": {
                    "filter": {
                      "range": {
                        "number": {
                          "gte": 170,
                          "lte": 230
                        }
                      }
                    },
                    "aggs": {
                      "employee_again": {
                        "nested": {
                          "path": "employees"
                        },
                        "aggs": {
                          "status_id_filter": {
                            "filter": {
                              "term": {
                                "employees.status_ids": "step 2"
                              }
                            },
                            "aggs": {
                              "minute": {
                                "reverse_nested": {
                                },
                                "aggs": {
                                  "minute_histogram": {
                                    "histogram": {
                                      "field": "number",
                                      "interval": 1
                                    },
                                    "aggs": {
                                      "employee": {
                                        "nested": {
                                          "path": "employees"
                                        },
                                        "aggs": {
                                          "employee": {
                                            "terms": {
                                              "field": "employees.number",
                                              "size": 1
                                            },
                                            "aggs": {
                                              "employee_id": {
                                                "terms": {
                                                  "field": "employees.employee_id",
                                                  "size": 1
                                                },
                                                "aggs": {
                                                  "bookings": {
                                                    "nested": {
                                                      "path": "employees.bookings"
                                                    },
                                                    "aggs": {
                                                      "booking": {
                                                        "terms": {
                                                          "field": "employees.bookings.booking_id",
                                                          "size": 1
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "step 3": {
    "filters": {
      "filters": {
        "other_orders": {
          "nested": {
            "path": "employees",
            "query": {
              "bool": {
                "must": [
                  {
                    "nested": {
                      "path": "employees.bookings",
                      "query": {
                        "bool": {
                          "must_not": [
                            {
                              "term": {
                                "employees.bookings.order_id": {
                                  "value": "3l0C3GsBMgHivpysT9hG"
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "current_order": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "term": {
                    "employees.bookings.order_id": {
                      "value": "3l0C3GsBMgHivpysT9hG"
                    }
                  }
                }
              }
            }
          }
        },
        "no_bookings": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "bool": {
                    "must_not": [
                      {
                        "exists": {
                          "field": "employees.bookings.status_id"
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "aggs": {
      "blocked_minutes_filter": {
        "filter": {
          "bool": {
            "must_not": [
              {
                "terms": {
                  "number": [
                    721,
                    722,
                    723,
                    724,
                    725,
                    726,
                    727,
                    728,
                    729,
                    730,
                    240,
                    720,
                    91,
                    92,
                    93,
                    94,
                    95,
                    96,
                    97,
                    98,
                    99,
                    100,
                    101,
                    160,
                    161,
                    162,
                    163,
                    164,
                    165,
                    166,
                    167,
                    168,
                    169,
                    170,
                    230,
                    231,
                    232,
                    233,
                    234,
                    235,
                    236,
                    237,
                    238,
                    239,
                    300,
                    301,
                    302,
                    303,
                    304,
                    305,
                    306,
                    307,
                    308,
                    309,
                    310,
                    370,
                    371,
                    372,
                    373,
                    374,
                    375,
                    376,
                    377,
                    378,
                    379,
                    380,
                    440,
                    441,
                    442,
                    443,
                    444,
                    445,
                    446,
                    447,
                    448,
                    449,
                    450,
                    510,
                    511,
                    512,
                    513,
                    514,
                    515,
                    516,
                    517,
                    518,
                    519,
                    520,
                    580,
                    581,
                    582,
                    583,
                    584,
                    585,
                    586,
                    587,
                    588,
                    589,
                    590,
                    650
                  ]
                }
              }
            ]
          }
        },
        "aggs": {
          "employees": {
            "nested": {
              "path": "employees"
            },
            "aggs": {
              "back_to_minutes": {
                "reverse_nested": {
                },
                "aggs": {
                  "status_minute_range": {
                    "filter": {
                      "range": {
                        "number": {
                          "gte": 240,
                          "lte": 300
                        }
                      }
                    },
                    "aggs": {
                      "employee_again": {
                        "nested": {
                          "path": "employees"
                        },
                        "aggs": {
                          "status_id_filter": {
                            "filter": {
                              "term": {
                                "employees.status_ids": "step 3"
                              }
                            },
                            "aggs": {
                              "minute": {
                                "reverse_nested": {
                                },
                                "aggs": {
                                  "minute_histogram": {
                                    "histogram": {
                                      "field": "number",
                                      "interval": 1
                                    },
                                    "aggs": {
                                      "employee": {
                                        "nested": {
                                          "path": "employees"
                                        },
                                        "aggs": {
                                          "employee": {
                                            "terms": {
                                              "field": "employees.number",
                                              "size": 1
                                            },
                                            "aggs": {
                                              "employee_id": {
                                                "terms": {
                                                  "field": "employees.employee_id",
                                                  "size": 1
                                                },
                                                "aggs": {
                                                  "bookings": {
                                                    "nested": {
                                                      "path": "employees.bookings"
                                                    },
                                                    "aggs": {
                                                      "booking": {
                                                        "terms": {
                                                          "field": "employees.bookings.booking_id",
                                                          "size": 1
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "step 4": {
    "filters": {
      "filters": {
        "other_orders": {
          "nested": {
            "path": "employees",
            "query": {
              "bool": {
                "must": [
                  {
                    "nested": {
                      "path": "employees.bookings",
                      "query": {
                        "bool": {
                          "must_not": [
                            {
                              "term": {
                                "employees.bookings.order_id": {
                                  "value": "3l0C3GsBMgHivpysT9hG"
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "current_order": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "term": {
                    "employees.bookings.order_id": {
                      "value": "3l0C3GsBMgHivpysT9hG"
                    }
                  }
                }
              }
            }
          }
        },
        "no_bookings": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "bool": {
                    "must_not": [
                      {
                        "exists": {
                          "field": "employees.bookings.status_id"
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "aggs": {
      "blocked_minutes_filter": {
        "filter": {
          "bool": {
            "must_not": [
              {
                "terms": {
                  "number": [
                    721,
                    722,
                    723,
                    724,
                    725,
                    726,
                    727,
                    728,
                    729,
                    730,
                    310,
                    720,
                    91,
                    92,
                    93,
                    94,
                    95,
                    96,
                    97,
                    98,
                    99,
                    100,
                    101,
                    160,
                    161,
                    162,
                    163,
                    164,
                    165,
                    166,
                    167,
                    168,
                    169,
                    170,
                    230,
                    231,
                    232,
                    233,
                    234,
                    235,
                    236,
                    237,
                    238,
                    239,
                    240,
                    300,
                    301,
                    302,
                    303,
                    304,
                    305,
                    306,
                    307,
                    308,
                    309,
                    370,
                    371,
                    372,
                    373,
                    374,
                    375,
                    376,
                    377,
                    378,
                    379,
                    380,
                    440,
                    441,
                    442,
                    443,
                    444,
                    445,
                    446,
                    447,
                    448,
                    449,
                    450,
                    510,
                    511,
                    512,
                    513,
                    514,
                    515,
                    516,
                    517,
                    518,
                    519,
                    520,
                    580,
                    581,
                    582,
                    583,
                    584,
                    585,
                    586,
                    587,
                    588,
                    589,
                    590,
                    650
                  ]
                }
              }
            ]
          }
        },
        "aggs": {
          "employees": {
            "nested": {
              "path": "employees"
            },
            "aggs": {
              "back_to_minutes": {
                "reverse_nested": {
                },
                "aggs": {
                  "status_minute_range": {
                    "filter": {
                      "range": {
                        "number": {
                          "gte": 310,
                          "lte": 370
                        }
                      }
                    },
                    "aggs": {
                      "employee_again": {
                        "nested": {
                          "path": "employees"
                        },
                        "aggs": {
                          "status_id_filter": {
                            "filter": {
                              "term": {
                                "employees.status_ids": "step 4"
                              }
                            },
                            "aggs": {
                              "minute": {
                                "reverse_nested": {
                                },
                                "aggs": {
                                  "minute_histogram": {
                                    "histogram": {
                                      "field": "number",
                                      "interval": 1
                                    },
                                    "aggs": {
                                      "employee": {
                                        "nested": {
                                          "path": "employees"
                                        },
                                        "aggs": {
                                          "employee": {
                                            "terms": {
                                              "field": "employees.number",
                                              "size": 1
                                            },
                                            "aggs": {
                                              "employee_id": {
                                                "terms": {
                                                  "field": "employees.employee_id",
                                                  "size": 1
                                                },
                                                "aggs": {
                                                  "bookings": {
                                                    "nested": {
                                                      "path": "employees.bookings"
                                                    },
                                                    "aggs": {
                                                      "booking": {
                                                        "terms": {
                                                          "field": "employees.bookings.booking_id",
                                                          "size": 1
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "step 5": {
    "filters": {
      "filters": {
        "other_orders": {
          "nested": {
            "path": "employees",
            "query": {
              "bool": {
                "must": [
                  {
                    "nested": {
                      "path": "employees.bookings",
                      "query": {
                        "bool": {
                          "must_not": [
                            {
                              "term": {
                                "employees.bookings.order_id": {
                                  "value": "3l0C3GsBMgHivpysT9hG"
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "current_order": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "term": {
                    "employees.bookings.order_id": {
                      "value": "3l0C3GsBMgHivpysT9hG"
                    }
                  }
                }
              }
            }
          }
        },
        "no_bookings": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "bool": {
                    "must_not": [
                      {
                        "exists": {
                          "field": "employees.bookings.status_id"
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "aggs": {
      "blocked_minutes_filter": {
        "filter": {
          "bool": {
            "must_not": [
              {
                "terms": {
                  "number": [
                    721,
                    722,
                    723,
                    724,
                    725,
                    726,
                    727,
                    728,
                    729,
                    730,
                    380,
                    720,
                    91,
                    92,
                    93,
                    94,
                    95,
                    96,
                    97,
                    98,
                    99,
                    100,
                    101,
                    160,
                    161,
                    162,
                    163,
                    164,
                    165,
                    166,
                    167,
                    168,
                    169,
                    170,
                    230,
                    231,
                    232,
                    233,
                    234,
                    235,
                    236,
                    237,
                    238,
                    239,
                    240,
                    300,
                    301,
                    302,
                    303,
                    304,
                    305,
                    306,
                    307,
                    308,
                    309,
                    310,
                    370,
                    371,
                    372,
                    373,
                    374,
                    375,
                    376,
                    377,
                    378,
                    379,
                    440,
                    441,
                    442,
                    443,
                    444,
                    445,
                    446,
                    447,
                    448,
                    449,
                    450,
                    510,
                    511,
                    512,
                    513,
                    514,
                    515,
                    516,
                    517,
                    518,
                    519,
                    520,
                    580,
                    581,
                    582,
                    583,
                    584,
                    585,
                    586,
                    587,
                    588,
                    589,
                    590,
                    650
                  ]
                }
              }
            ]
          }
        },
        "aggs": {
          "employees": {
            "nested": {
              "path": "employees"
            },
            "aggs": {
              "back_to_minutes": {
                "reverse_nested": {
                },
                "aggs": {
                  "status_minute_range": {
                    "filter": {
                      "range": {
                        "number": {
                          "gte": 380,
                          "lte": 440
                        }
                      }
                    },
                    "aggs": {
                      "employee_again": {
                        "nested": {
                          "path": "employees"
                        },
                        "aggs": {
                          "status_id_filter": {
                            "filter": {
                              "term": {
                                "employees.status_ids": "step 5"
                              }
                            },
                            "aggs": {
                              "minute": {
                                "reverse_nested": {
                                },
                                "aggs": {
                                  "minute_histogram": {
                                    "histogram": {
                                      "field": "number",
                                      "interval": 1
                                    },
                                    "aggs": {
                                      "employee": {
                                        "nested": {
                                          "path": "employees"
                                        },
                                        "aggs": {
                                          "employee": {
                                            "terms": {
                                              "field": "employees.number",
                                              "size": 1
                                            },
                                            "aggs": {
                                              "employee_id": {
                                                "terms": {
                                                  "field": "employees.employee_id",
                                                  "size": 1
                                                },
                                                "aggs": {
                                                  "bookings": {
                                                    "nested": {
                                                      "path": "employees.bookings"
                                                    },
                                                    "aggs": {
                                                      "booking": {
                                                        "terms": {
                                                          "field": "employees.bookings.booking_id",
                                                          "size": 1
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "step 6": {
    "filters": {
      "filters": {
        "other_orders": {
          "nested": {
            "path": "employees",
            "query": {
              "bool": {
                "must": [
                  {
                    "nested": {
                      "path": "employees.bookings",
                      "query": {
                        "bool": {
                          "must_not": [
                            {
                              "term": {
                                "employees.bookings.order_id": {
                                  "value": "3l0C3GsBMgHivpysT9hG"
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "current_order": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "term": {
                    "employees.bookings.order_id": {
                      "value": "3l0C3GsBMgHivpysT9hG"
                    }
                  }
                }
              }
            }
          }
        },
        "no_bookings": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "bool": {
                    "must_not": [
                      {
                        "exists": {
                          "field": "employees.bookings.status_id"
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "aggs": {
      "blocked_minutes_filter": {
        "filter": {
          "bool": {
            "must_not": [
              {
                "terms": {
                  "number": [
                    721,
                    722,
                    723,
                    724,
                    725,
                    726,
                    727,
                    728,
                    729,
                    730,
                    450,
                    720,
                    91,
                    92,
                    93,
                    94,
                    95,
                    96,
                    97,
                    98,
                    99,
                    100,
                    101,
                    160,
                    161,
                    162,
                    163,
                    164,
                    165,
                    166,
                    167,
                    168,
                    169,
                    170,
                    230,
                    231,
                    232,
                    233,
                    234,
                    235,
                    236,
                    237,
                    238,
                    239,
                    240,
                    300,
                    301,
                    302,
                    303,
                    304,
                    305,
                    306,
                    307,
                    308,
                    309,
                    310,
                    370,
                    371,
                    372,
                    373,
                    374,
                    375,
                    376,
                    377,
                    378,
                    379,
                    380,
                    440,
                    441,
                    442,
                    443,
                    444,
                    445,
                    446,
                    447,
                    448,
                    449,
                    510,
                    511,
                    512,
                    513,
                    514,
                    515,
                    516,
                    517,
                    518,
                    519,
                    520,
                    580,
                    581,
                    582,
                    583,
                    584,
                    585,
                    586,
                    587,
                    588,
                    589,
                    590,
                    650
                  ]
                }
              }
            ]
          }
        },
        "aggs": {
          "employees": {
            "nested": {
              "path": "employees"
            },
            "aggs": {
              "back_to_minutes": {
                "reverse_nested": {
                },
                "aggs": {
                  "status_minute_range": {
                    "filter": {
                      "range": {
                        "number": {
                          "gte": 450,
                          "lte": 510
                        }
                      }
                    },
                    "aggs": {
                      "employee_again": {
                        "nested": {
                          "path": "employees"
                        },
                        "aggs": {
                          "status_id_filter": {
                            "filter": {
                              "term": {
                                "employees.status_ids": "step 6"
                              }
                            },
                            "aggs": {
                              "minute": {
                                "reverse_nested": {
                                },
                                "aggs": {
                                  "minute_histogram": {
                                    "histogram": {
                                      "field": "number",
                                      "interval": 1
                                    },
                                    "aggs": {
                                      "employee": {
                                        "nested": {
                                          "path": "employees"
                                        },
                                        "aggs": {
                                          "employee": {
                                            "terms": {
                                              "field": "employees.number",
                                              "size": 1
                                            },
                                            "aggs": {
                                              "employee_id": {
                                                "terms": {
                                                  "field": "employees.employee_id",
                                                  "size": 1
                                                },
                                                "aggs": {
                                                  "bookings": {
                                                    "nested": {
                                                      "path": "employees.bookings"
                                                    },
                                                    "aggs": {
                                                      "booking": {
                                                        "terms": {
                                                          "field": "employees.bookings.booking_id",
                                                          "size": 1
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "step 7": {
    "filters": {
      "filters": {
        "other_orders": {
          "nested": {
            "path": "employees",
            "query": {
              "bool": {
                "must": [
                  {
                    "nested": {
                      "path": "employees.bookings",
                      "query": {
                        "bool": {
                          "must_not": [
                            {
                              "term": {
                                "employees.bookings.order_id": {
                                  "value": "3l0C3GsBMgHivpysT9hG"
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "current_order": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "term": {
                    "employees.bookings.order_id": {
                      "value": "3l0C3GsBMgHivpysT9hG"
                    }
                  }
                }
              }
            }
          }
        },
        "no_bookings": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "bool": {
                    "must_not": [
                      {
                        "exists": {
                          "field": "employees.bookings.status_id"
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "aggs": {
      "blocked_minutes_filter": {
        "filter": {
          "bool": {
            "must_not": [
              {
                "terms": {
                  "number": [
                    721,
                    722,
                    723,
                    724,
                    725,
                    726,
                    727,
                    728,
                    729,
                    730,
                    520,
                    720,
                    91,
                    92,
                    93,
                    94,
                    95,
                    96,
                    97,
                    98,
                    99,
                    100,
                    101,
                    160,
                    161,
                    162,
                    163,
                    164,
                    165,
                    166,
                    167,
                    168,
                    169,
                    170,
                    230,
                    231,
                    232,
                    233,
                    234,
                    235,
                    236,
                    237,
                    238,
                    239,
                    240,
                    300,
                    301,
                    302,
                    303,
                    304,
                    305,
                    306,
                    307,
                    308,
                    309,
                    310,
                    370,
                    371,
                    372,
                    373,
                    374,
                    375,
                    376,
                    377,
                    378,
                    379,
                    380,
                    440,
                    441,
                    442,
                    443,
                    444,
                    445,
                    446,
                    447,
                    448,
                    449,
                    450,
                    510,
                    511,
                    512,
                    513,
                    514,
                    515,
                    516,
                    517,
                    518,
                    519,
                    580,
                    581,
                    582,
                    583,
                    584,
                    585,
                    586,
                    587,
                    588,
                    589,
                    590,
                    650
                  ]
                }
              }
            ]
          }
        },
        "aggs": {
          "employees": {
            "nested": {
              "path": "employees"
            },
            "aggs": {
              "back_to_minutes": {
                "reverse_nested": {
                },
                "aggs": {
                  "status_minute_range": {
                    "filter": {
                      "range": {
                        "number": {
                          "gte": 520,
                          "lte": 580
                        }
                      }
                    },
                    "aggs": {
                      "employee_again": {
                        "nested": {
                          "path": "employees"
                        },
                        "aggs": {
                          "status_id_filter": {
                            "filter": {
                              "term": {
                                "employees.status_ids": "step 7"
                              }
                            },
                            "aggs": {
                              "minute": {
                                "reverse_nested": {
                                },
                                "aggs": {
                                  "minute_histogram": {
                                    "histogram": {
                                      "field": "number",
                                      "interval": 1
                                    },
                                    "aggs": {
                                      "employee": {
                                        "nested": {
                                          "path": "employees"
                                        },
                                        "aggs": {
                                          "employee": {
                                            "terms": {
                                              "field": "employees.number",
                                              "size": 1
                                            },
                                            "aggs": {
                                              "employee_id": {
                                                "terms": {
                                                  "field": "employees.employee_id",
                                                  "size": 1
                                                },
                                                "aggs": {
                                                  "bookings": {
                                                    "nested": {
                                                      "path": "employees.bookings"
                                                    },
                                                    "aggs": {
                                                      "booking": {
                                                        "terms": {
                                                          "field": "employees.bookings.booking_id",
                                                          "size": 1
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "step 8": {
    "filters": {
      "filters": {
        "other_orders": {
          "nested": {
            "path": "employees",
            "query": {
              "bool": {
                "must": [
                  {
                    "nested": {
                      "path": "employees.bookings",
                      "query": {
                        "bool": {
                          "must_not": [
                            {
                              "term": {
                                "employees.bookings.order_id": {
                                  "value": "3l0C3GsBMgHivpysT9hG"
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "current_order": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "term": {
                    "employees.bookings.order_id": {
                      "value": "3l0C3GsBMgHivpysT9hG"
                    }
                  }
                }
              }
            }
          }
        },
        "no_bookings": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "bool": {
                    "must_not": [
                      {
                        "exists": {
                          "field": "employees.bookings.status_id"
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "aggs": {
      "blocked_minutes_filter": {
        "filter": {
          "bool": {
            "must_not": [
              {
                "terms": {
                  "number": [
                    721,
                    722,
                    723,
                    724,
                    725,
                    726,
                    727,
                    728,
                    729,
                    730,
                    590,
                    720,
                    91,
                    92,
                    93,
                    94,
                    95,
                    96,
                    97,
                    98,
                    99,
                    100,
                    101,
                    160,
                    161,
                    162,
                    163,
                    164,
                    165,
                    166,
                    167,
                    168,
                    169,
                    170,
                    230,
                    231,
                    232,
                    233,
                    234,
                    235,
                    236,
                    237,
                    238,
                    239,
                    240,
                    300,
                    301,
                    302,
                    303,
                    304,
                    305,
                    306,
                    307,
                    308,
                    309,
                    310,
                    370,
                    371,
                    372,
                    373,
                    374,
                    375,
                    376,
                    377,
                    378,
                    379,
                    380,
                    440,
                    441,
                    442,
                    443,
                    444,
                    445,
                    446,
                    447,
                    448,
                    449,
                    450,
                    510,
                    511,
                    512,
                    513,
                    514,
                    515,
                    516,
                    517,
                    518,
                    519,
                    520,
                    580,
                    581,
                    582,
                    583,
                    584,
                    585,
                    586,
                    587,
                    588,
                    589,
                    650
                  ]
                }
              }
            ]
          }
        },
        "aggs": {
          "employees": {
            "nested": {
              "path": "employees"
            },
            "aggs": {
              "back_to_minutes": {
                "reverse_nested": {
                },
                "aggs": {
                  "status_minute_range": {
                    "filter": {
                      "range": {
                        "number": {
                          "gte": 590,
                          "lte": 650
                        }
                      }
                    },
                    "aggs": {
                      "employee_again": {
                        "nested": {
                          "path": "employees"
                        },
                        "aggs": {
                          "status_id_filter": {
                            "filter": {
                              "term": {
                                "employees.status_ids": "step 8"
                              }
                            },
                            "aggs": {
                              "minute": {
                                "reverse_nested": {
                                },
                                "aggs": {
                                  "minute_histogram": {
                                    "histogram": {
                                      "field": "number",
                                      "interval": 1
                                    },
                                    "aggs": {
                                      "employee": {
                                        "nested": {
                                          "path": "employees"
                                        },
                                        "aggs": {
                                          "employee": {
                                            "terms": {
                                              "field": "employees.number",
                                              "size": 1
                                            },
                                            "aggs": {
                                              "employee_id": {
                                                "terms": {
                                                  "field": "employees.employee_id",
                                                  "size": 1
                                                },
                                                "aggs": {
                                                  "bookings": {
                                                    "nested": {
                                                      "path": "employees.bookings"
                                                    },
                                                    "aggs": {
                                                      "booking": {
                                                        "terms": {
                                                          "field": "employees.bookings.booking_id",
                                                          "size": 1
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "step 9": {
    "filters": {
      "filters": {
        "other_orders": {
          "nested": {
            "path": "employees",
            "query": {
              "bool": {
                "must": [
                  {
                    "nested": {
                      "path": "employees.bookings",
                      "query": {
                        "bool": {
                          "must_not": [
                            {
                              "term": {
                                "employees.bookings.order_id": {
                                  "value": "3l0C3GsBMgHivpysT9hG"
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "current_order": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "term": {
                    "employees.bookings.order_id": {
                      "value": "3l0C3GsBMgHivpysT9hG"
                    }
                  }
                }
              }
            }
          }
        },
        "no_bookings": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "bool": {
                    "must_not": [
                      {
                        "exists": {
                          "field": "employees.bookings.status_id"
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "aggs": {
      "blocked_minutes_filter": {
        "filter": {
          "bool": {
            "must_not": [
              {
                "terms": {
                  "number": [
                    721,
                    722,
                    723,
                    724,
                    725,
                    726,
                    727,
                    728,
                    729,
                    730,
                    660,
                    720,
                    91,
                    92,
                    93,
                    94,
                    95,
                    96,
                    97,
                    98,
                    99,
                    100,
                    101,
                    160,
                    161,
                    162,
                    163,
                    164,
                    165,
                    166,
                    167,
                    168,
                    169,
                    170,
                    230,
                    231,
                    232,
                    233,
                    234,
                    235,
                    236,
                    237,
                    238,
                    239,
                    240,
                    300,
                    301,
                    302,
                    303,
                    304,
                    305,
                    306,
                    307,
                    308,
                    309,
                    310,
                    370,
                    371,
                    372,
                    373,
                    374,
                    375,
                    376,
                    377,
                    378,
                    379,
                    380,
                    440,
                    441,
                    442,
                    443,
                    444,
                    445,
                    446,
                    447,
                    448,
                    449,
                    450,
                    510,
                    511,
                    512,
                    513,
                    514,
                    515,
                    516,
                    517,
                    518,
                    519,
                    520,
                    580,
                    581,
                    582,
                    583,
                    584,
                    585,
                    586,
                    587,
                    588,
                    589,
                    590
                  ]
                }
              }
            ]
          }
        },
        "aggs": {
          "employees": {
            "nested": {
              "path": "employees"
            },
            "aggs": {
              "back_to_minutes": {
                "reverse_nested": {
                },
                "aggs": {
                  "status_minute_range": {
                    "filter": {
                      "range": {
                        "number": {
                          "gte": 660,
                          "lte": 720
                        }
                      }
                    },
                    "aggs": {
                      "employee_again": {
                        "nested": {
                          "path": "employees"
                        },
                        "aggs": {
                          "status_id_filter": {
                            "filter": {
                              "term": {
                                "employees.status_ids": "step 9"
                              }
                            },
                            "aggs": {
                              "minute": {
                                "reverse_nested": {
                                },
                                "aggs": {
                                  "minute_histogram": {
                                    "histogram": {
                                      "field": "number",
                                      "interval": 1
                                    },
                                    "aggs": {
                                      "employee": {
                                        "nested": {
                                          "path": "employees"
                                        },
                                        "aggs": {
                                          "employee": {
                                            "terms": {
                                              "field": "employees.number",
                                              "size": 1
                                            },
                                            "aggs": {
                                              "employee_id": {
                                                "terms": {
                                                  "field": "employees.employee_id",
                                                  "size": 1
                                                },
                                                "aggs": {
                                                  "bookings": {
                                                    "nested": {
                                                      "path": "employees.bookings"
                                                    },
                                                    "aggs": {
                                                      "booking": {
                                                        "terms": {
                                                          "field": "employees.bookings.booking_id",
                                                          "size": 1
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "step 10": {
    "filters": {
      "filters": {
        "other_orders": {
          "nested": {
            "path": "employees",
            "query": {
              "bool": {
                "must": [
                  {
                    "nested": {
                      "path": "employees.bookings",
                      "query": {
                        "bool": {
                          "must_not": [
                            {
                              "term": {
                                "employees.bookings.order_id": {
                                  "value": "3l0C3GsBMgHivpysT9hG"
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "current_order": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "term": {
                    "employees.bookings.order_id": {
                      "value": "3l0C3GsBMgHivpysT9hG"
                    }
                  }
                }
              }
            }
          }
        },
        "no_bookings": {
          "nested": {
            "path": "employees",
            "query": {
              "nested": {
                "path": "employees.bookings",
                "query": {
                  "bool": {
                    "must_not": [
                      {
                        "exists": {
                          "field": "employees.bookings.status_id"
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "aggs": {
      "blocked_minutes_filter": {
        "filter": {
          "bool": {
            "must_not": [
              {
                "terms": {
                  "number": [
                    730,
                    721,
                    722,
                    723,
                    724,
                    725,
                    726,
                    727,
                    728,
                    729,
                    731,
                    720,
                    91,
                    92,
                    93,
                    94,
                    95,
                    96,
                    97,
                    98,
                    99,
                    100,
                    101,
                    160,
                    161,
                    162,
                    163,
                    164,
                    165,
                    166,
                    167,
                    168,
                    169,
                    170,
                    230,
                    231,
                    232,
                    233,
                    234,
                    235,
                    236,
                    237,
                    238,
                    239,
                    240,
                    300,
                    301,
                    302,
                    303,
                    304,
                    305,
                    306,
                    307,
                    308,
                    309,
                    310,
                    370,
                    371,
                    372,
                    373,
                    374,
                    375,
                    376,
                    377,
                    378,
                    379,
                    380,
                    440,
                    441,
                    442,
                    443,
                    444,
                    445,
                    446,
                    447,
                    448,
                    449,
                    450,
                    510,
                    511,
                    512,
                    513,
                    514,
                    515,
                    516,
                    517,
                    518,
                    519,
                    520,
                    580,
                    581,
                    582,
                    583,
                    584,
                    585,
                    586,
                    587,
                    588,
                    589,
                    590
                  ]
                }
              }
            ]
          }
        },
        "aggs": {
          "employees": {
            "nested": {
              "path": "employees"
            },
            "aggs": {
              "back_to_minutes": {
                "reverse_nested": {
                },
                "aggs": {
                  "status_minute_range": {
                    "filter": {
                      "range": {
                        "number": {
                          "gte": 730,
                          "lte": 790
                        }
                      }
                    },
                    "aggs": {
                      "employee_again": {
                        "nested": {
                          "path": "employees"
                        },
                        "aggs": {
                          "status_id_filter": {
                            "filter": {
                              "term": {
                                "employees.status_ids": "step 10"
                              }
                            },
                            "aggs": {
                              "minute": {
                                "reverse_nested": {
                                },
                                "aggs": {
                                  "minute_histogram": {
                                    "histogram": {
                                      "field": "number",
                                      "interval": 1
                                    },
                                    "aggs": {
                                      "employee": {
                                        "nested": {
                                          "path": "employees"
                                        },
                                        "aggs": {
                                          "employee": {
                                            "terms": {
                                              "field": "employees.number",
                                              "size": 1
                                            },
                                            "aggs": {
                                              "employee_id": {
                                                "terms": {
                                                  "field": "employees.employee_id",
                                                  "size": 1
                                                },
                                                "aggs": {
                                                  "bookings": {
                                                    "nested": {
                                                      "path": "employees.bookings"
                                                    },
                                                    "aggs": {
                                                      "booking": {
                                                        "terms": {
                                                          "field": "employees.bookings.booking_id",
                                                          "size": 1
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}